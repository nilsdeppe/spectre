# Distributed under the MIT License.
# See LICENSE.txt for details.

Executable: EvolveGhNoBlackHole3D
Testing:
  Check: parse;execute
  Timeout: 8
  Priority: High
ExpectedOutput:
  - GhGaugeWave3DVolume0.h5
  - GhGaugeWave3DReductions.h5

---

Parallelization:
  ElementDistribution: NumGridPoints
# NumberOfThreads: 16

ResourceInfo:
  AvoidGlobalProc0: false
  Singletons: Auto

Evolution:
  InitialTime: 0.0
  InitialTimeStep: 0.0002
  MinimumTimeStep: 1e-7
  TimeStepper:
    # DormandPrince5:
    AdamsBashforth:
      Order: 5
  StepChoosers:
    - Increase:
        Factor: 2
    - ElementSizeCfl:
        SafetyFactor: 0.5
    - ErrorControl:
        AbsoluteTolerance: 1e-8
        RelativeTolerance: 1e-6
        MaxFactor: 2
        MinFactor: 0.25
        SafetyFactor: 0.95

Amr:
  Criteria:
  Policies:
    EnforceTwoToOneBalanceInNormalDirection: true
    Isotropy: Anisotropic
    Limits:
      RefinementLevel: Auto
      NumGridPoints: Auto
  Verbosity: Quiet

PhaseChangeAndTriggers:
  # - Trigger:
  #     Slabs:
  #      EvenlySpaced:
  #        # Current implementation checks wallclock at these global syncs
  #        Interval: 100
  #        Offset: 0
  #   PhaseChanges:
  #     - CheckpointAndExitAfterWallclock:
  #         WallclockHours: None

InitialData: &InitialData
  GeneralizedHarmonic(GaugeWave):
    Amplitude: 0.1
    Wavelength: 1.0

DomainCreator:
  # Brick:
  #   LowerBound: [0.0, 0.0, 0.0]
  #   UpperBound: [1.0, 1.0, 1.0]
  #   Distribution: [Linear, Linear, Linear]
  #   InitialRefinement: [1, 1, 1]
  #   InitialGridPoints: [5, 5, 5]
  #   TimeDependence: None
  #   BoundaryConditions: [Periodic, Periodic, Periodic]
  Sphere:
    InnerRadius: 2.0
    OuterRadius: 100.0
    Interior:
      ExciseWithBoundaryCondition:
        DirichletAnalytic:
          AnalyticPrescription: *InitialData
      # FillWithSphericity: 0.
    # InitialRefinement: 1
    InitialRefinement:
      Shell0: [1, 1, 1]
      Shell1: [1, 1, 1]
      Shell2: [1, 1, 1]
      Shell3: [1, 1, 1]
    InitialGridPoints: [10, 10, 10]
    RadialPartitioning: [4, 10, 40]
    RadialDistribution: [Logarithmic, Logarithmic, Logarithmic, Logarithmic]
    UseEquiangularMap: True
    EquatorialCompression: None
    WhichWedges: All
    TimeDependentMaps: None
    OuterBoundaryCondition:
      # ConstraintPreservingBjorhus:
      #     Type: ConstraintPreservingPhysical
      DirichletAnalytic:
        AnalyticPrescription: *InitialData

EvolutionSystem:
  GeneralizedHarmonic:
    GaugeCondition:
      Harmonic:
      # AnalyticChristoffel:
      #   AnalyticPrescription: *InitialData
    DampingFunctionGamma0:
      GaussianPlusConstant:
        Constant: 1.0
        Amplitude: 0.0
        Width: 1.0
        Center: [0.0, 0.0, 0.0]
    DampingFunctionGamma1:
      GaussianPlusConstant:
        Constant: -1.0
        Amplitude: 0.0
        Width: 1.0
        Center: [0.0, 0.0, 0.0]
    DampingFunctionGamma2:
      GaussianPlusConstant:
        Constant: 1.0
        Amplitude: 0.0
        Width: 1.0
        Center: [0.0, 0.0, 0.0]

Filtering:
  ExpFilter0:
    Alpha: 36.0
    HalfPower: 128
    Enable: false
    BlocksToFilter: All

SpatialDiscretization:
  DiscontinuousGalerkin:
    Formulation: StrongInertial
    Quadrature: GaussLobatto
  BoundaryCorrection:
    UpwindPenalty:

EventsAndTriggers:
  - Trigger:
      Slabs:
        EvenlySpaced:
          Interval: 1
          Offset: 0
    Events:
      - ObserveNorms:
          SubfileName: Errors
          TensorsToObserve:
            - Name: Error(SpacetimeMetric)
              NormType: L2Norm
              Components: Sum
            - Name: Error(Pi)
              NormType: L2Norm
              Components: Sum
            - Name: Error(Phi)
              NormType: L2Norm
              Components: Sum
  - Trigger:
      Slabs:
        EvenlySpaced:
          Interval: 5
          Offset: 0
    Events:
      - ObserveFields:
          SubfileName: VolumeData
          VariablesToObserve:
            - SpacetimeMetric
            - Pi
            - Phi
            - PointwiseL2Norm(GaugeConstraint)
            - PointwiseL2Norm(ThreeIndexConstraint)
            - PointwiseL2Norm(FourIndexConstraint)
          InterpolateToMesh: None
          CoordinatesFloatingPointType: Double
          FloatingPointTypes: [Double]
          BlocksToObserve: All
  - Trigger:
      Slabs:
        Specified:
          Values: [15]
    Events:
      - Completion

EventsAndDenseTriggers:

Observers:
  VolumeFileName: "GhGaugeWave3DVolume"
  ReductionFileName: "GhGaugeWave3DReductions"
